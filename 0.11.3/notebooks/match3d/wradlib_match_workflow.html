

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Match spaceborn SR (GPM/TRMM) with ground radars GR &mdash; wradlib</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/wradlib.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="wradlib" href="../../index.html"/>
        <link rel="up" title="Tutorials and Examples" href="../../notebooks.html"/>
        <link rel="next" title="For Developers" href="../develop.html"/>
        <link rel="prev" title="Zonal Statistics" href="../zonalstats/wradlib_zonalstats_classes.html"/>
    
    <link href="../../_static/wradlib.css" rel="stylesheet" type="text/css">


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

  <a href="../../index.html" class="icon icon-home"> wradlib



</a>



  <div class="version">
    
    <button class="verbtn">0.11.3</button>
    <div class="version-content">
      
        <a href="../latest/">latest</a>
        <a href="../0.11.3/">0.11.3</a>
        <a href="../0.11.1/">0.11.1</a>
    </div>
  </div>



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../notebooks.html">Tutorials and Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../jupyter.html">How to use the tutorials and examples?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learnpython.html">An incomplete introduction to Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Getting started with wradlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fileio.html">Data Input - Data Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../attenuation/wradlib_attenuation.html">Attenuation correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beamblockage/wradlib_beamblock.html">Beam Blockage Calculation using a DEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../classify.html">Clutter and Echo Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../georeferencing.html">Georeferencing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Match spaceborn SR (GPM/TRMM) with ground radars GR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Conventions">Conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Data-Input">Data Input</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Read-and-organize-the-GR-data">Read and organize the GR data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Data-handling">Data handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Extract-relevant-GR-data-and-meta-data">Extract relevant GR data and meta-data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calculate-GR-Bounding-Box">Calculate GR Bounding Box</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Read-and-organize-the-SR-data">Read and organize the SR data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Extract-relevant-SR-data-and-meta-data">Extract relevant SR data and meta-data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Georeferencing">Georeferencing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Set-fundamental-georeferencing-parameters">Set fundamental georeferencing parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Georeference-GR-data">Georeference GR data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Georeference-SR-data">Georeference SR data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Subset-relevant-SR-data">Subset relevant SR data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#SR-Parallax-Correction">SR Parallax Correction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Compute-spherical-coordinates-of-SR-bins-with-regard-to-GR">Compute spherical coordinates of SR bins with regard to GR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Compute-SR-and-GR-pulse-volumes">Compute SR and GR pulse volumes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Median-Brightband-Width/Height">Median Brightband Width/Height</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Convert-SR-Ku-reflectivities-to-S-band">Convert SR Ku reflectivities to S-band</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Convert-S-band-GR-reflectivities-to-Ku-band">Convert S-band GR reflectivities to Ku-band</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Matching-SR/GR">Matching SR/GR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Identify-which-SR-rays-actually-intersect-with-the-GR-sweep">Identify which SR rays actually intersect with the GR sweep</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Identify-which-GR-bins-actually-intersect-with-the-SR-footprint">Identify which GR bins actually intersect with the SR footprint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Diagnostic-Plots">Diagnostic Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Former-Method-using-loop">Former Method using loop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop.html">For Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpolation/wradlib_ipol_example.html">How to use wradlib’s ipol module for interpolation tasks?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisensor/wradlib_adjust_example.html">Adjusting radar-base rainfall estimates by rain gauge observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../verification/wradlib_verify_example.html">Routine verification measures for radar-based precipitation estimates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recipes.html">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../radolan.html">RADOLAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zonalstats/wradlib_zonalstats_classes.html">Zonal Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_setup.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zreferences.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">wradlib</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../notebooks.html">Tutorials and Examples</a> &raquo;</li>
        
      <li>Match spaceborn SR (GPM/TRMM) with ground radars GR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/match3d/wradlib_match_workflow.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Match-spaceborn-SR-(GPM/TRMM)-with-ground-radars-GR">
<h1>Match spaceborn SR (GPM/TRMM) with ground radars GR<a class="headerlink" href="#Match-spaceborn-SR-(GPM/TRMM)-with-ground-radars-GR" title="Permalink to this headline">¶</a></h1>
<p>The idea is to match ground radar (GR) and space-born radar (SR)
measurements in order to create spatially and temporally coicident
samples without interpolation. The procedure had been suggested by
<a class="reference external" href="http://journals.ametsoc.org/doi/pdf/10.1175/2010JTECHA1403.1">Schwaller and Morris
(2011)</a>
and is based on the adaption by <a class="reference external" href="https://journals.ametsoc.org/doi/pdf/10.1175/JTECH-D-17-0128.1">Warren, et. al.
(2017)</a>.</p>
<p>The basic principle is illustrated in Fig. 2 of the original paper of
Schwaller and Morris (2011):</p>
<div class="figure" id="id1">
<img alt="image" src="../../_images/fig2_schwaller_morris_2011.png" />
<p class="caption"><span class="caption-text">image</span></p>
</div>
<p><em>Quote Warren, et.al: “[…] In this approach, intersections between indi
vidual SR beams and GR elevation sweeps are identified and the
reflectivity values from both instruments are averaged within a spatial
neighborhood around the intersection. Specifically, SR data are averaged
in range over the width of the GR beam at the GR range of the
intersection, while GR data are averaged in the range–azimuth plane
within the footprint of the SR beam. The result is a pair of
reflectivity measurements corresponding to approximately the same volume
of atmosphere. […]”.</em></p>
<p>This becomes clearer in Fig. 3: <img alt="image" src="../../_images/fig3_schwaller_morris_2011.png" /></p>
<p>Schwaller, MR, and Morris, KR. 2011. A ground validation network for the
Global Precipitation Measurement mission. J. Atmos. Oceanic Technol.,
28, 301-319.</p>
<p>Warren, R.A., A. Protat, S.T. Siems, H.A. Ramsay, V. Louf, M.J. Manton,
and T.A. Kane, 0: Calibrating ground-based radars against TRMM and GPM.
J. Atmos. Oceanic Technol., 0,</p>
<div class="section" id="Conventions">
<h2>Conventions<a class="headerlink" href="#Conventions" title="Permalink to this headline">¶</a></h2>
<p>This code is based on the following conventions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gr</span></code> indicates <strong>g</strong>round <strong>r</strong>adar</li>
<li><code class="docutils literal notranslate"><span class="pre">sr</span></code> indicates <strong>s</strong>pace-born precipitation <strong>r</strong>adar (TRMM or
GPM)</li>
</ul>
<p>The base routines are designed to process one GR sweep at a time. If a
full GR volume with <code class="docutils literal notranslate"><span class="pre">nelev</span></code> of sweeps is available, you can iterate
over each sweep. In this code, <code class="docutils literal notranslate"><span class="pre">ee</span></code> is an index that points to one of
the <code class="docutils literal notranslate"><span class="pre">nelev</span></code> sweeps/elevation angles. Accordingly, a <strong>GR</strong> data set
will be organised as an array of shape
<code class="docutils literal notranslate"><span class="pre">(nelev_gr,</span> <span class="pre">nray_gr,</span> <span class="pre">ngate_gr)</span></code>.</p>
<p>A <strong>SR</strong> data set is typically organised as arrays with dimensions
<code class="docutils literal notranslate"><span class="pre">(nscan_sr,</span> <span class="pre">nray_sr,</span> <span class="pre">ngate_sr)</span></code>.</p>
<p><em>Please note</em>: the GR and SR datasets are managed by using convenience
functions from the module file <code class="docutils literal notranslate"><span class="pre">io_func.py</span></code> located in the same
directory as this notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">wradlib</span> <span class="kn">as</span> <span class="nn">wrl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">from_levels_and_colors</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">magic</span><span class="p">(</span><span class="s2">&quot;matplotlib inline&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># define GPM data set</span>
<span class="n">gpm_file</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_wradlib_data_file</span><span class="p">(</span><span class="s1">&#39;gpm/2A-CS-151E24S154E30S.GPM.Ku.V7-20170308.20141206-S095002-E095137.004383.V05A.HDF5&#39;</span><span class="p">)</span>
<span class="c1"># define matching ground radar file</span>
<span class="n">gr2gpm_file</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_wradlib_data_file</span><span class="p">(</span><span class="s1">&#39;hdf5/IDR66_20141206_094829.vol.h5&#39;</span><span class="p">)</span>

<span class="c1"># define TRMM data sets</span>
<span class="n">trmm_2a23_file</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_wradlib_data_file</span><span class="p">(</span><span class="s1">&#39;trmm/2A-CS-151E24S154E30S.TRMM.PR.2A23.20100206-S111425-E111526.069662.7.HDF&#39;</span><span class="p">)</span>
<span class="n">trmm_2a25_file</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_wradlib_data_file</span><span class="p">(</span><span class="s1">&#39;trmm/2A-CS-151E24S154E30S.TRMM.PR.2A25.20100206-S111425-E111526.069662.7.HDF&#39;</span><span class="p">)</span>

<span class="c1"># define matching ground radar file</span>
<span class="n">gr2trmm_file</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_wradlib_data_file</span><span class="p">(</span><span class="s1">&#39;hdf5/IDR66_20100206_111233.vol.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Space-born precipitation radar parameters</span>
<span class="n">sr_pars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trmm&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;zt&quot;</span><span class="p">:</span> <span class="mf">402500.</span><span class="p">,</span>  <span class="c1"># orbital height of TRMM (post boost)   APPROXIMATION!</span>
    <span class="s2">&quot;dr&quot;</span><span class="p">:</span> <span class="mf">250.</span><span class="p">,</span>     <span class="c1"># gate spacing of TRMM</span>
    <span class="s2">&quot;gr_file&quot;</span><span class="p">:</span> <span class="n">gr2trmm_file</span><span class="p">,</span>
<span class="p">},</span> <span class="s2">&quot;gpm&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;zt&quot;</span><span class="p">:</span> <span class="mf">407000.</span><span class="p">,</span>  <span class="c1"># orbital height of GPM                 APPROXIMATION!</span>
    <span class="s2">&quot;dr&quot;</span><span class="p">:</span> <span class="mf">125.</span><span class="p">,</span>      <span class="c1"># gate spacing of GPM</span>
    <span class="s2">&quot;gr_file&quot;</span><span class="p">:</span> <span class="n">gr2gpm_file</span><span class="p">,</span>
<span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set parameters for this procedure</span>
<span class="n">bw_sr</span> <span class="o">=</span> <span class="mf">0.71</span>                  <span class="c1"># SR beam width</span>
<span class="n">platf</span> <span class="o">=</span> <span class="s2">&quot;trmm&quot;</span>                 <span class="c1"># SR platform/product: one out of [&quot;gpm&quot;, &quot;trmm&quot;]</span>
<span class="n">zt</span> <span class="o">=</span> <span class="n">sr_pars</span><span class="p">[</span><span class="n">platf</span><span class="p">][</span><span class="s2">&quot;zt&quot;</span><span class="p">]</span>     <span class="c1"># SR orbit height (meters)</span>
<span class="n">dr_sr</span> <span class="o">=</span> <span class="n">sr_pars</span><span class="p">[</span><span class="n">platf</span><span class="p">][</span><span class="s2">&quot;dr&quot;</span><span class="p">]</span>  <span class="c1"># SR gate length (meters)</span>
<span class="n">gr_file</span> <span class="o">=</span> <span class="n">sr_pars</span><span class="p">[</span><span class="n">platf</span><span class="p">][</span><span class="s2">&quot;gr_file&quot;</span><span class="p">]</span>
<span class="n">ee</span> <span class="o">=</span> <span class="mi">2</span>                        <span class="c1"># Index that points to the GR elevation angle to be used</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Data-Input">
<h2>Data Input<a class="headerlink" href="#Data-Input" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Read-and-organize-the-GR-data">
<h3>Read and organize the GR data<a class="headerlink" href="#Read-and-organize-the-GR-data" title="Permalink to this headline">¶</a></h3>
<p>The following code reads data in ODIM H5 format. If your GR data is in
some other format respective adaptions are needed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">_get_tilts</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;dataset&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">i</span>


<span class="k">def</span> <span class="nf">read_gr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">loaddata</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

    <span class="n">gr_data</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_generic_netcdf</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
    <span class="n">tim</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dat</span> <span class="o">+</span> <span class="n">tim</span><span class="p">,</span> <span class="s2">&quot;%Y</span><span class="si">%d</span><span class="s2">%m%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>

    <span class="n">lon</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PVOL&#39;</span><span class="p">:</span>
        <span class="n">ntilt</span> <span class="o">=</span> <span class="n">_get_tilts</span><span class="p">(</span><span class="n">gr_data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;GR file is no PPI/Volume File&#39;</span><span class="p">)</span>

    <span class="n">ngate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">nbeam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">)</span>
    <span class="n">elang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">)</span>
    <span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">)</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntilt</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ntilt</span><span class="p">):</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;dataset{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">a0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;how&#39;</span><span class="p">][</span><span class="s1">&#39;astart&#39;</span><span class="p">]</span>
        <span class="n">elang</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;elangle&#39;</span><span class="p">]</span>
        <span class="n">ngate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;nbins&#39;</span><span class="p">]</span>
        <span class="n">r0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;rstart&#39;</span><span class="p">]</span>
        <span class="n">dr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;rscale&#39;</span><span class="p">]</span>
        <span class="n">nbeam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">][</span><span class="s1">&#39;nrays&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">r0</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dr</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">a0</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">nbeam</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">nbeam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">360</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;GroundRadar Data layout dos not match&#39;</span><span class="p">)</span>

    <span class="n">gr_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">gr_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
                    <span class="s1">&#39;alt&#39;</span><span class="p">:</span> <span class="n">alt</span><span class="p">,</span> <span class="s1">&#39;ngate&#39;</span><span class="p">:</span> <span class="n">ngate</span><span class="p">,</span> <span class="s1">&#39;nbeam&#39;</span><span class="p">:</span> <span class="n">nbeam</span><span class="p">,</span> <span class="s1">&#39;ntilt&#39;</span><span class="p">:</span> <span class="n">ntilt</span><span class="p">,</span>
                    <span class="s1">&#39;r0&#39;</span><span class="p">:</span> <span class="n">r0</span><span class="p">,</span> <span class="s1">&#39;dr&#39;</span><span class="p">:</span> <span class="n">dr</span><span class="p">,</span> <span class="s1">&#39;a0&#39;</span><span class="p">:</span> <span class="n">a0</span><span class="p">,</span> <span class="s1">&#39;elang&#39;</span><span class="p">:</span> <span class="n">elang</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">loaddata</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gr_dict</span>

    <span class="n">sdate</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">refl</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ntilt</span><span class="p">):</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;dataset{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span>
        <span class="n">tim</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dat</span> <span class="o">+</span> <span class="n">tim</span><span class="p">,</span> <span class="s2">&quot;%Y</span><span class="si">%d</span><span class="s2">%m%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">sdate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">][</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s1">&#39;DBZH&#39;</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span> <span class="o">+</span> <span class="n">offset</span>
            <span class="n">refl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>

    <span class="n">sdate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sdate</span><span class="p">)</span>
    <span class="n">refl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">refl</span><span class="p">)</span>

    <span class="n">gr_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;sdate&#39;</span><span class="p">:</span> <span class="n">sdate</span><span class="p">,</span> <span class="s1">&#39;refl&#39;</span><span class="p">:</span> <span class="n">refl</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">gr_dict</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># read matching GR data</span>
<span class="n">gr_data</span> <span class="o">=</span> <span class="n">read_gr</span><span class="p">(</span><span class="n">gr_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Data-handling">
<h2>Data handling<a class="headerlink" href="#Data-handling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Extract-relevant-GR-data-and-meta-data">
<h3>Extract relevant GR data and meta-data<a class="headerlink" href="#Extract-relevant-GR-data-and-meta-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># number of rays in gr sweep</span>
<span class="n">nray_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;nbeam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;i4&quot;</span><span class="p">)[</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># number of gates in gr beam</span>
<span class="n">ngate_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;ngate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;i4&quot;</span><span class="p">)[</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># number of sweeps</span>
<span class="n">nelev</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;ntilt&#39;</span><span class="p">]</span>
<span class="c1"># elevation of sweep (degree)</span>
<span class="n">elev_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;elang&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># gate length (meters)</span>
<span class="n">dr_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;dr&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># reflectivity array of sweep</span>
<span class="n">ref_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;refl&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># sweep datetime stamp</span>
<span class="n">date_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;sdate&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># range of first gate</span>
<span class="n">r0_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;r0&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># azimuth angle of first beam</span>
<span class="n">a0_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;a0&#39;</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span>
<span class="c1"># Longitude of GR</span>
<span class="n">lon0_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
<span class="c1"># Latitude of GR</span>
<span class="n">lat0_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
<span class="c1"># Altitude of GR (meters)</span>
<span class="n">alt0_gr</span> <span class="o">=</span> <span class="n">gr_data</span><span class="p">[</span><span class="s1">&#39;alt&#39;</span><span class="p">]</span>
<span class="c1"># Beam width of GR (degree)</span>
<span class="n">bw_gr</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="k">print</span><span class="p">(</span><span class="n">elev_gr</span><span class="p">,</span> <span class="n">lon0_gr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1.2999999523162842, 153.24000549316406)
</pre></div></div>
</div>
</div>
<div class="section" id="Calculate-GR-Bounding-Box">
<h3>Calculate GR Bounding Box<a class="headerlink" href="#Calculate-GR-Bounding-Box" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coord</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">sweep_centroids</span><span class="p">(</span><span class="n">nray_gr</span><span class="p">,</span> <span class="n">dr_gr</span><span class="p">,</span> <span class="n">ngate_gr</span><span class="p">,</span> <span class="n">elev_gr</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">spherical_to_proj</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                                      <span class="n">coord</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                      <span class="p">(</span><span class="n">lon0_gr</span><span class="p">,</span> <span class="n">lat0_gr</span><span class="p">,</span> <span class="n">alt0_gr</span><span class="p">))</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">alt</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">zonalstats</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Radar bounding box:</span><span class="se">\n\t</span><span class="si">%.2f</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">           </span><span class="si">%.2f</span><span class="se">\n\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Radar bounding box:
        -26.37
151.72           154.76
        -29.07
</pre></div></div>
</div>
</div>
<div class="section" id="Read-and-organize-the-SR-data">
<h3>Read and organize the SR data<a class="headerlink" href="#Read-and-organize-the-SR-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># read spaceborn SR data</span>
<span class="k">if</span> <span class="n">platf</span> <span class="o">==</span> <span class="s2">&quot;gpm&quot;</span><span class="p">:</span>
    <span class="n">sr_data</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_gpm</span><span class="p">(</span><span class="n">gpm_file</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">platf</span> <span class="o">==</span> <span class="s2">&quot;trmm&quot;</span><span class="p">:</span>
    <span class="n">sr_data</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_trmm</span><span class="p">(</span><span class="n">trmm_2a23_file</span><span class="p">,</span> <span class="n">trmm_2a25_file</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span><span class="p">(</span><span class="s2">&quot;Invalid platform&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">refl</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;refl&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">refl</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]

 [[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]

 [[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]

 ...

 [[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]

 [[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]

 [[-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  ...
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]
  [-- -- -- ... 0.0 0.0 0.0]]]
</pre></div></div>
</div>
</div>
<div class="section" id="Extract-relevant-SR-data-and-meta-data">
<h3>Extract relevant SR data and meta-data<a class="headerlink" href="#Extract-relevant-SR-data-and-meta-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Longitudes of SR scans</span>
<span class="n">sr_lon</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
<span class="c1"># Latitudes of SR scans</span>
<span class="n">sr_lat</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
<span class="c1"># Precip flag</span>
<span class="n">pflag</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;pflag&#39;</span><span class="p">]</span>
<span class="c1"># Number of scans on SR data</span>
<span class="n">nscan_sr</span><span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;nscan&#39;</span><span class="p">]</span>
<span class="c1"># Number of rays in one SR scan</span>
<span class="n">nray_sr</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;nray&#39;</span><span class="p">]</span>
<span class="c1"># Number of gates in one SR ray</span>
<span class="n">ngate_sr</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;nbin&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">sr_lon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(94, 49)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Georeferencing">
<h2>Georeferencing<a class="headerlink" href="#Georeferencing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Set-fundamental-georeferencing-parameters">
<h3>Set fundamental georeferencing parameters<a class="headerlink" href="#Set-fundamental-georeferencing-parameters" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calculate equivalent earth radius</span>
<span class="n">wgs84</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">get_default_projection</span><span class="p">()</span>
<span class="n">re1</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">get_earth_radius</span><span class="p">(</span><span class="n">lat0_gr</span><span class="p">,</span> <span class="n">wgs84</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Earth radius 1:&quot;</span><span class="p">,</span> <span class="n">re1</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">wgs84</span><span class="o">.</span><span class="n">GetSemiMajor</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">wgs84</span><span class="o">.</span><span class="n">GetSemiMinor</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;SemiMajor, SemiMinor:&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># Set up aeqd-projection gr-centered</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">proj4_to_osr</span><span class="p">((</span><span class="s1">&#39;+proj=aeqd +lon_0={lon:f} &#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;+lat_0={lat:f} +a={a:f} &#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;+b={b:f}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon0_gr</span><span class="p">,</span>
                                                      <span class="n">lat</span><span class="o">=</span><span class="n">lat0_gr</span><span class="p">,</span>
                                                      <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">))</span>
<span class="n">re2</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">get_earth_radius</span><span class="p">(</span><span class="n">lat0_gr</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Earth radius 2:&quot;</span><span class="p">,</span> <span class="n">re2</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;Earth radius 1:&#39;, 6373541.039814419)
(&#39;SemiMajor, SemiMinor:&#39;, 6378137.0, 6356752.314245179)
(&#39;Earth radius 2:&#39;, 6373541.039814381)
</pre></div></div>
</div>
</div>
<div class="section" id="Georeference-GR-data">
<h3>Georeference GR data<a class="headerlink" href="#Georeference-GR-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create gr range and azimuth arrays</span>
<span class="n">rmax_gr</span> <span class="o">=</span> <span class="n">r0_gr</span> <span class="o">+</span> <span class="n">ngate_gr</span> <span class="o">*</span> <span class="n">dr_gr</span>
<span class="n">r_gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ngate_gr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr_gr</span> <span class="o">+</span> <span class="n">dr_gr</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">az_gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nray_gr</span><span class="p">)</span> <span class="o">-</span> <span class="n">a0_gr</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Range/Azi-Shape:&quot;</span><span class="p">,</span> <span class="n">r_gr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">az_gr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># create gr polar grid and calculate aeqd-xyz coordinates</span>
<span class="n">gr_polargrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r_gr</span><span class="p">,</span> <span class="n">az_gr</span><span class="p">)</span>
<span class="n">gr_xyz</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">spherical_to_xyz</span><span class="p">(</span><span class="n">gr_polargrid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gr_polargrid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">elev_gr</span><span class="p">,</span> <span class="p">(</span><span class="n">lon0_gr</span><span class="p">,</span> <span class="n">lat0_gr</span><span class="p">,</span> <span class="n">alt0_gr</span> <span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;XYZ-Grid-Shape:&quot;</span><span class="p">,</span> <span class="n">gr_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># create gr poygon array in aeqd-xyz-coordinates</span>
<span class="n">gr_poly</span><span class="p">,</span> <span class="n">rad1</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">spherical_to_polyvert</span><span class="p">(</span><span class="n">r_gr</span><span class="p">,</span> <span class="n">az_gr</span><span class="p">,</span> <span class="n">elev_gr</span><span class="p">,</span> <span class="p">(</span><span class="n">lon0_gr</span><span class="p">,</span> <span class="n">lat0_gr</span><span class="p">,</span> <span class="n">alt0_gr</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">gr_poly</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">360</span> <span class="o">*</span> <span class="mi">600</span><span class="p">)</span>
<span class="n">gr_poly</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nray_gr</span><span class="p">,</span> <span class="n">ngate_gr</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># get radar domain (outer ring)</span>
<span class="n">gr_domain</span> <span class="o">=</span> <span class="n">gr_xyz</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">gr_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">gr_domain</span><span class="p">,</span> <span class="n">gr_domain</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Domain-Shape:&quot;</span><span class="p">,</span> <span class="n">gr_domain</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;Range/Azi-Shape:&#39;, (600,), (360,))
(&#39;XYZ-Grid-Shape:&#39;, (360, 600, 3))
((216000, 5, 3), 216000)
(&#39;Domain-Shape:&#39;, (361, 2))
</pre></div></div>
</div>
</div>
<div class="section" id="Georeference-SR-data">
<h3>Georeference SR data<a class="headerlink" href="#Georeference-SR-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sr_x</span><span class="p">,</span> <span class="n">sr_y</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span><span class="n">sr_lon</span><span class="p">,</span> <span class="n">sr_lat</span><span class="p">,</span>
                                      <span class="n">projection_source</span><span class="o">=</span><span class="n">wgs84</span><span class="p">,</span>
                                      <span class="n">projection_target</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
<span class="n">sr_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">sr_x</span><span class="p">,</span> <span class="n">sr_y</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;SR-GRID-Shapes:&quot;</span><span class="p">,</span> <span class="n">sr_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;SR-GRID-Shapes:&#39;, (94, 49), (94, 49), (94, 49, 2))
</pre></div></div>
</div>
</div>
<div class="section" id="Subset-relevant-SR-data">
<h3>Subset relevant SR data<a class="headerlink" href="#Subset-relevant-SR-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create ZonalData for spatial subsetting (inside GR range domain)</span>

<span class="c1"># get precip indexes</span>
<span class="k">print</span><span class="p">(</span><span class="n">sr_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pflag</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">precip_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">pflag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">wrl</span><span class="o">.</span><span class="n">zonalstats</span><span class="o">.</span><span class="n">get_clip_mask</span><span class="p">(</span><span class="n">sr_xy</span><span class="p">,</span> <span class="n">gr_domain</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>

<span class="c1"># get iscan/iray boolean arrays</span>
<span class="k">print</span><span class="p">(</span><span class="n">precip_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pflag</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_xy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sr_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">precip_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(94, 49, 2)
(94, 49)
((94, 49), (94, 49, 2))
((94, 49), (4606, 2))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[17]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x7fec4882ff90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_31_2.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_31_2.png" />
</div>
</div>
</div>
<div class="section" id="SR-Parallax-Correction">
<h3>SR Parallax Correction<a class="headerlink" href="#SR-Parallax-Correction" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;NRAY&quot;</span><span class="p">,</span> <span class="n">nray_sr</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;NBIN&quot;</span><span class="p">,</span> <span class="n">ngate_sr</span><span class="p">)</span>

<span class="c1"># use localZenith Angle</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;zenith&#39;</span><span class="p">]</span>
<span class="n">beta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">17.04</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nray_sr</span><span class="p">)</span> <span class="o">*</span> <span class="n">bw_sr</span><span class="p">)</span>

<span class="c1"># Correct for parallax, get 3D-XYZ-Array</span>
<span class="c1">#   xyzp_sr: Parallax corrected xyz coordinates</span>
<span class="c1">#   r_sr_inv: range array from ground to SR platform</span>
<span class="c1">#   zp: SR bin altitudes</span>
<span class="n">xyp_sr</span><span class="p">,</span> <span class="n">r_sr_inv</span><span class="p">,</span> <span class="n">z_sr</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">correct_parallax</span><span class="p">(</span><span class="n">sr_xy</span><span class="p">,</span> <span class="n">ngate_sr</span><span class="p">,</span> <span class="n">dr_sr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">xyp_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">r_sr_inv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">z_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">xyzp_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xyp_sr</span><span class="p">,</span> <span class="n">z_sr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span>
                   <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sr_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;SR_XYP:&quot;</span><span class="p">,</span> <span class="n">xyp_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xyzp_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">r_sr_inv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">z_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;NRAY&#39;, 49)
(&#39;NBIN&#39;, 80)
((94, 49, 80, 2), (80,), (94, 49, 80))
(94, 49, 2)
(&#39;SR_XYP:&#39;, (94, 49, 80, 2), (94, 49, 80, 3), (80,), (94, 49, 80))
</pre></div></div>
</div>
</div>
<div class="section" id="Compute-spherical-coordinates-of-SR-bins-with-regard-to-GR">
<h3>Compute spherical coordinates of SR bins with regard to GR<a class="headerlink" href="#Compute-spherical-coordinates-of-SR-bins-with-regard-to-GR" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r_sr</span><span class="p">,</span> <span class="n">az_sr</span><span class="p">,</span> <span class="n">elev_sr</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">xyz_to_spherical</span><span class="p">(</span><span class="n">xyzp_sr</span><span class="p">,</span> <span class="n">alt0_gr</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
<span class="c1">#TODO: hardcoded 1.0</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">elev_sr</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">bw_gr</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">elev_sr</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">bw_gr</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="mi">40</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.QuadMesh at 0x7fec487f4c50&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_35_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_35_1.png" />
</div>
</div>
</div>
<div class="section" id="Compute-SR-and-GR-pulse-volumes">
<h3>Compute SR and GR pulse volumes<a class="headerlink" href="#Compute-SR-and-GR-pulse-volumes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Calculate-distance-from-orbit-">
<h4>Calculate distance from orbit <span class="math notranslate">\(r_s\)</span><a class="headerlink" href="#Calculate-distance-from-orbit-" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rs</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">dist_from_orbit</span><span class="p">(</span><span class="n">zt</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">r_sr_inv</span><span class="p">,</span> <span class="n">re1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="SR-pulse-volume">
<h4>SR pulse volume<a class="headerlink" href="#SR-pulse-volume" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Small anngle approximation</span>
<span class="n">vol_sr2</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">dr_sr</span> <span class="o">*</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bw_sr</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Or using wradlib&#39;s native function</span>
<span class="n">vol_sr</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">qual</span><span class="o">.</span><span class="n">pulse_volume</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">dr_sr</span><span class="p">,</span> <span class="n">bw_sr</span><span class="p">)</span>
<span class="c1"># Evaluate difference between both approaches</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Min. difference (m3):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vol_sr</span> <span class="o">-</span> <span class="n">vol_sr2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Max. difference (m3): &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vol_sr</span> <span class="o">-</span> <span class="n">vol_sr2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Average rel. difference (%):&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol_sr</span><span class="o">-</span><span class="n">vol_sr2</span><span class="p">)</span><span class="o">*</span><span class="mf">100.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol_sr2</span><span class="p">)),</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Verdict: differences are negligble - use wradlibs&#39;s native function!</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;Min. difference (m3):&#39;, 113043.78644371033)
(&#39;Max. difference (m3): &#39;, 137576.38737678528)
(&#39;Average rel. difference (%):&#39;, 0.0026)
</pre></div></div>
</div>
</div>
<div class="section" id="GR-pulse-volume">
<h4>GR pulse volume<a class="headerlink" href="#GR-pulse-volume" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># GR pulse volumes</span>
<span class="c1">#   along one beam</span>
<span class="n">vol_gr</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">qual</span><span class="o">.</span><span class="n">pulse_volume</span><span class="p">(</span><span class="n">r_gr</span><span class="p">,</span> <span class="n">dr_gr</span><span class="p">,</span> <span class="n">bw_gr</span><span class="p">)</span>
<span class="c1">#   with shape (nray_gr, ngate_gr)</span>
<span class="n">vol_gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">vol_gr</span><span class="p">,</span> <span class="n">nray_gr</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nray_gr</span><span class="p">,</span> <span class="n">ngate_gr</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Calculate-horizontal-and-vertical-dimensions--and--of-SR-bins">
<h4>Calculate horizontal and vertical dimensions <span class="math notranslate">\(R_s\)</span> and <span class="math notranslate">\(D_s\)</span> of SR bins<a class="headerlink" href="#Calculate-horizontal-and-vertical-dimensions--and--of-SR-bins" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Rs</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bw_sr</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">Ds</span> <span class="o">=</span> <span class="n">dr_sr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="n">Ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">Rs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Median-Brightband-Width/Height">
<h3>Median Brightband Width/Height<a class="headerlink" href="#Median-Brightband-Width/Height" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">z_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;zbb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;bbwidth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ratio</span><span class="p">,</span> <span class="n">ibb</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">qual</span><span class="o">.</span><span class="n">get_bb_ratio</span><span class="p">(</span><span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;zbb&#39;</span><span class="p">],</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;bbwidth&#39;</span><span class="p">],</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">zbb</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;zbb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">zbb</span><span class="p">[</span><span class="o">~</span><span class="n">ibb</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))</span>
<span class="c1">#pl.imshow(ratio, vmin=-10, vmax=30)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(94, 49, 80)
((94, 49), (94, 49), (94, 49))
(94, 49, 80)
(-2.480953963698855, -2.302551401079081)
</pre></div></div>
</div>
</div>
<div class="section" id="Convert-SR-Ku-reflectivities-to-S-band">
<h3>Convert SR Ku reflectivities to S-band<a class="headerlink" href="#Convert-SR-Ku-reflectivities-to-S-band" title="Permalink to this headline">¶</a></h3>
<p>Based on <a class="reference external" href="http://dx.doi.org/10.1002/jgrd.50138">Cao et.al (2013)</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ref_sr</span> <span class="o">=</span> <span class="n">sr_data</span><span class="p">[</span><span class="s1">&#39;refl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ref_sr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ref_sr_ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ref_sr_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">a_s</span><span class="p">,</span> <span class="n">a_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">ku2s</span><span class="o">.</span><span class="n">snow</span><span class="p">,</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">ku2s</span><span class="o">.</span><span class="n">hail</span><span class="p">)</span>

<span class="n">ia</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ref_sr_ss</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">ia</span><span class="p">],</span> <span class="n">a_s</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ref_sr_sh</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">ia</span><span class="p">],</span> <span class="n">a_h</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ib</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ref_sr_ss</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span> <span class="n">a_s</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ref_sr_sh</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span> <span class="n">a_h</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
<span class="n">ref_sr_ss</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">a_s</span><span class="p">[:,</span><span class="n">ind</span><span class="p">])</span>
<span class="n">ref_sr_sh</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_sr</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">+</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">a_h</span><span class="p">[:,</span><span class="n">ind</span><span class="p">])</span>

<span class="c1"># Jackson Tan&#39;s fix for C-band</span>
<span class="n">is_cband</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="p">(</span><span class="n">is_cband</span><span class="p">):</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_sr_ss</span> <span class="o">-</span> <span class="n">ref_sr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">5.3</span> <span class="o">/</span> <span class="mf">10.0</span>
    <span class="n">ref_sr_ss</span> <span class="o">=</span> <span class="n">outref_sr</span> <span class="o">+</span> <span class="n">deltas</span>
    <span class="n">deltah</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_sr_sh</span> <span class="o">-</span> <span class="n">ref_sr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">5.3</span> <span class="o">/</span> <span class="mf">10.0</span>
    <span class="n">ref_sr_sh</span> <span class="o">=</span> <span class="n">ref_sr</span> <span class="o">+</span> <span class="n">deltah</span>

<span class="n">ref_sr_ss</span><span class="p">[</span><span class="n">ref_sr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((94, 49, 80), (94, 49, 80))
</pre></div></div>
</div>
</div>
<div class="section" id="Convert-S-band-GR-reflectivities-to-Ku-band">
<h3>Convert S-band GR reflectivities to Ku-band<a class="headerlink" href="#Convert-S-band-GR-reflectivities-to-Ku-band" title="Permalink to this headline">¶</a></h3>
<p>Using the method of <a class="reference external" href="http://dx.doi.org/10.1175/2008JAMC1974.1">Liao and Meneghini
(2009)</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Convert S-band GR reflectivities to Ku-band using method of Liao and Meneghini (2009)</span>
<span class="n">ref_gr_ku</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ref_gr</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># Which zbb value should we take here???</span>
<span class="c1">#    Q&#39;n&#39;Dirty: just take the mean of all SR profiles</span>
<span class="c1">#    TODO: Consider zbb for each profile during the matching process</span>

<span class="c1"># Snow</span>
<span class="n">ia</span> <span class="o">=</span> <span class="p">(</span> <span class="n">gr_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">zbb</span><span class="p">)</span> <span class="p">)</span>
<span class="c1">#ref_gr_ku[ia] = wrl.trafo.ku2s.snow[0] + wrl.trafo.ku2s.snow[1]*ref_gr[ia] + wrl.trafo.ku2s.snow[2]*ref_gr[ia]**2</span>
<span class="n">ref_gr_ku</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_gr</span><span class="p">[</span><span class="n">ia</span><span class="p">],</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">s2ku</span><span class="o">.</span><span class="n">snow</span><span class="p">)</span>
<span class="c1"># Rain</span>
<span class="n">ib</span> <span class="o">=</span> <span class="p">(</span> <span class="n">gr_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">zbb</span><span class="p">)</span> <span class="p">)</span>
<span class="c1">#ref_gr_ku[ib] = wrl.trafo.ku2s.rain[0] + wrl.trafo.ku2s.rain[1]*ref_gr[ia] + wrl.trafo.ku2s.rain[2]*ref_gr[ia]**2</span>
<span class="n">ref_gr_ku</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">calculate_polynomial</span><span class="p">(</span><span class="n">ref_gr</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">s2ku</span><span class="o">.</span><span class="n">rain</span><span class="p">)</span>

<span class="c1"># Jackson Tan&#39;s fix for C-band</span>
<span class="n">is_cband</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="p">(</span><span class="n">is_cband</span><span class="p">):</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_gr_ku</span> <span class="o">-</span> <span class="n">ref_gr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">5.3</span><span class="o">/</span><span class="mf">10.0</span>
    <span class="n">ref_gr_ku</span> <span class="o">=</span> <span class="n">ref_gr</span> <span class="o">+</span> <span class="n">delta</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Matching-SR/GR">
<h2>Matching SR/GR<a class="headerlink" href="#Matching-SR/GR" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Identify-which-SR-rays-actually-intersect-with-the-GR-sweep">
<h3>Identify which SR rays actually intersect with the GR sweep<a class="headerlink" href="#Identify-which-SR-rays-actually-intersect-with-the-GR-sweep" title="Permalink to this headline">¶</a></h3>
<p>Based on the above criteria (in radar range, precipitating SR profile)
and based on SR elevation angle (with regard to GR).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First assumption: no valid SR bins (all False)</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elev_sr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span>
<span class="k">print</span><span class="p">(</span><span class="n">valid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">precip_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># SR is inside GR range and is precipitating</span>
<span class="n">iscan</span> <span class="o">=</span> <span class="n">precip_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">iray</span> <span class="o">=</span> <span class="n">precip_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">valid</span><span class="p">[</span><span class="n">iscan</span><span class="p">,</span><span class="n">iray</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="c1"># SR bins intersect with GR sweep</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">elev_sr</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">elev_gr</span><span class="o">-</span><span class="n">bw_gr</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">elev_sr</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">elev_gr</span><span class="o">+</span><span class="n">bw_gr</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="c1"># Number of matching SR bins per profile</span>
<span class="n">nvalids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># scan and ray indices for profiles with at least one valid bin</span>
<span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nvalids</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># number of profiles with at least one valid bin</span>
<span class="n">nprof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vscan</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vscan</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((94, 49, 80), (94, 49))
(1164,)
(94, 49, 80)
</pre></div></div>
</div>
<div class="section" id="Averaging-SR-parameters">
<h4>Averaging SR parameters<a class="headerlink" href="#Averaging-SR-parameters" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># average coordinates</span>
<span class="n">xyz_v1</span> <span class="o">=</span> <span class="n">xyzp_sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">xyz_v1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">xyz_v1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">xyz_c1</span> <span class="o">=</span> <span class="n">xyzp_sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">xyz_c1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">xyz_c1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ntotsr</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span><span class="p">]</span>
<span class="n">xyz_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xyz_v1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz_m1</span><span class="p">[</span><span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># approximate Rs</span>
<span class="n">rs_v1</span> <span class="o">=</span> <span class="n">Rs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rs_v1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">rs_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">rs_v1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rs_prof</span> <span class="o">=</span> <span class="n">rs_m1</span><span class="p">[</span><span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span><span class="p">]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">rs_prof</span>

<span class="c1"># approximate Ds</span>
<span class="n">ds_v1</span> <span class="o">=</span> <span class="n">Ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ds_v1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">ds_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">ds_v1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ds_prof</span> <span class="o">=</span> <span class="n">ds_m1</span><span class="p">[</span><span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span><span class="p">]</span>
<span class="n">dz</span> <span class="o">=</span> <span class="n">ds_prof</span>

<span class="c1"># approximate Vs</span>
<span class="n">vs_v1</span> <span class="o">=</span> <span class="n">vol_sr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vs_v1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">vs_m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">vs_v1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vs_prof</span> <span class="o">=</span> <span class="n">vs_m1</span><span class="p">[</span><span class="n">vscan</span><span class="p">,</span> <span class="n">vray</span><span class="p">]</span>
<span class="n">volsr1</span> <span class="o">=</span> <span class="n">vs_prof</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz_m1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyz_m1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz_m1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(94, 49, 80, 3)
((1164, 3), (94, 49))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[28]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;mpl_toolkits.mplot3d.art3d.Path3DCollection at 0x7fec4588b310&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_55_2.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_55_2.png" />
</div>
</div>
</div>
<div class="section" id="Calculate-spherical-coordinates-of-SR-sample-volume-with-respect-to-GR">
<h4>Calculate spherical coordinates of SR sample volume with respect to GR<a class="headerlink" href="#Calculate-spherical-coordinates-of-SR-sample-volume-with-respect-to-GR" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r_sr</span><span class="p">,</span> <span class="n">az_sr</span><span class="p">,</span> <span class="n">el_rs</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">xyz_to_spherical</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">alt0_gr</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Average-SR-reflectivity">
<h4>Average SR reflectivity<a class="headerlink" href="#Average-SR-reflectivity" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ref_sr_1</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">idecibel</span><span class="p">(</span><span class="n">ref_sr</span><span class="p">)</span>
<span class="n">ref_sr_1</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">refsr1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">ref_sr_1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="n">vscan</span><span class="p">,</span><span class="n">vray</span><span class="p">]</span>
<span class="n">refsr1a</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">decibel</span><span class="p">(</span><span class="n">refsr1a</span><span class="p">)</span>

<span class="n">ref_sr_2</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">idecibel</span><span class="p">(</span><span class="n">ref_sr_ss</span><span class="p">)</span>
<span class="n">ref_sr_2</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">refsr2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">ref_sr_2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="n">vscan</span><span class="p">,</span><span class="n">vray</span><span class="p">]</span>
<span class="n">refsr2a</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">decibel</span><span class="p">(</span><span class="n">refsr2a</span><span class="p">)</span>

<span class="n">ref_sr_3</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">idecibel</span><span class="p">(</span><span class="n">ref_sr_sh</span><span class="p">)</span>
<span class="n">ref_sr_3</span><span class="p">[</span><span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">refsr3a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">ref_sr_3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="n">vscan</span><span class="p">,</span><span class="n">vray</span><span class="p">]</span>
<span class="n">refsr3a</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">trafo</span><span class="o">.</span><span class="n">decibel</span><span class="p">(</span><span class="n">refsr3a</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="n">refsr1a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1164,)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Identify-which-GR-bins-actually-intersect-with-the-SR-footprint">
<h3>Identify which GR bins actually intersect with the SR footprint<a class="headerlink" href="#Identify-which-GR-bins-actually-intersect-with-the-SR-footprint" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Create-Zonal-Data-Source-of-matching-SR-profiles">
<h4>Create Zonal Data Source of matching SR profiles<a class="headerlink" href="#Create-Zonal-Data-Source-of-matching-SR-profiles" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">zds</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">zonalstats</span><span class="o">.</span><span class="n">DataSource</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">rad</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">zds</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1164
</pre></div></div>
</div>
</div>
<div class="section" id="Create-SR-beam-polygons-using-">
<h4>Create SR beam polygons using <span class="math notranslate">\(R_s\)</span><a class="headerlink" href="#Create-SR-beam-polygons-using-" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tmp_trg_lyr</span> <span class="o">=</span> <span class="n">zds</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>
<span class="n">trg_poly</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp_trg_lyr</span><span class="p">):</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">rs_prof</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">wrl</span><span class="o">.</span><span class="n">georef</span><span class="o">.</span><span class="n">ogr_to_numpy</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
    <span class="n">trg_poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-ZonalDataPoly-for-GR-and-SR-profiles">
<h4>Create ZonalDataPoly for GR and SR profiles<a class="headerlink" href="#Create-ZonalDataPoly-for-GR-and-SR-profiles" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">time</span>
print(&quot;creating&quot;)
zdp = wrl.zonalstats.ZonalDataPoly(gr_poly[..., 0:2].reshape(-1, 5, 2), trg_poly, srs=rad)
zdp.dump_vector(&#39;m3d_zonal_poly_{0}&#39;.format(platf))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
creating
CPU times: user 1min 39s, sys: 3.2 s, total: 1min 42s
Wall time: 1min 42s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">time</span>
print(&quot;loading&quot;)
obj3 = wrl.zonalstats.GridCellsToPoly(&#39;m3d_zonal_poly_{0}&#39;.format(platf))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
loading
CPU times: user 2min 14s, sys: 148 ms, total: 2min 14s
Wall time: 2min 14s
</pre></div></div>
</div>
</div>
<div class="section" id="Average-GR-volume-and-reflectivity">
<h4>Average GR volume and reflectivity<a class="headerlink" href="#Average-GR-volume-and-reflectivity" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">time</span>
print(obj3.ix.shape)
volgr1 = np.array([np.sum(vol_gr.ravel()[obj3.ix[i]])
                   for i in np.arange(len(obj3.ix))[~obj3.check_empty()]])
print(volgr1.shape)

ref_gr_i = wrl.trafo.idecibel(ref_gr.ravel())
ref_gr_ku_i = wrl.trafo.idecibel(ref_gr_ku.ravel())
refgr1a = np.array([np.nanmean(ref_gr_i[obj3.ix[i]])
             for i in np.arange(len(obj3.ix))[~obj3.check_empty()]])
refgr1a = wrl.trafo.decibel(refgr1a)
refgr2a = np.array([np.nanmean(ref_gr_ku_i[obj3.ix[i]])
             for i in np.arange(len(obj3.ix))[~obj3.check_empty()]])
refgr2a = wrl.trafo.decibel(refgr2a)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1164,)
(1164,)
CPU times: user 677 ms, sys: 15.9 ms, total: 693 ms
Wall time: 680 ms
</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Diagnostic-Plots">
<h2>Diagnostic Plots<a class="headerlink" href="#Diagnostic-Plots" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr1a</span><span class="p">,</span> <span class="n">refsr1a</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr1a</span><span class="p">[</span><span class="n">refsr1a</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr1a</span><span class="p">[</span><span class="n">refsr1a</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;uncorrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[36]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;uncorrected GR vs uncorrected SR&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_71_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_71_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2a</span><span class="p">,</span> <span class="n">refsr1a</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr1a</span><span class="p">[</span><span class="n">refsr1a</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr1a</span><span class="p">[</span><span class="n">refsr1a</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[37]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs uncorrected SR&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_72_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_72_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2a</span><span class="p">,</span> <span class="n">refsr2a</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr2a</span><span class="p">[</span><span class="n">refsr2a</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr2a</span><span class="p">[</span><span class="n">refsr2a</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs corrected SR snow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[38]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs corrected SR snow&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_73_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_73_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2a</span><span class="p">,</span> <span class="n">refsr3a</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr2a</span><span class="p">[</span><span class="n">refsr3a</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr3a</span><span class="p">[</span><span class="n">refsr3a</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs corrected SR hail&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[39]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs corrected SR hail&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_74_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_74_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">refsr1a</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SR reflectivity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">150000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">refgr1a</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;GR reflectivity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">150000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;uncorrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_75_0.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_75_0.png" />
</div>
</div>
</div>
<div class="section" id="Former-Method-using-loop">
<h2>Former Method using loop<a class="headerlink" href="#Former-Method-using-loop" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Lots of containers to store samples (only for one GR sweep angle!)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>        <span class="c1"># x coordinate of sample</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>        <span class="c1"># y coordinate of sample</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>        <span class="c1"># z coordinate of sample</span>
<span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>       <span class="c1"># depth of sample</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>       <span class="c1"># width of sample</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>       <span class="c1"># range of sample from GR</span>
<span class="n">refsr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># SR reflectivity</span>
<span class="n">refsr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># SR reflectivity (S-band, snow)</span>
<span class="n">refsr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># SR reflectivity (S-band, hail)</span>
<span class="n">refgr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># GR reflectivity</span>
<span class="n">refgr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># GR reflectivity (Ku-band)</span>
<span class="n">ntotpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4&quot;</span><span class="p">)</span><span class="c1"># total number of SR bins in sample</span>
<span class="n">nrej1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4&quot;</span><span class="p">)</span><span class="c1"># number of rejected SR bins in sample</span>
<span class="n">ntotgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4&quot;</span><span class="p">)</span><span class="c1"># total number of GR bins in sample</span>
<span class="n">nrej2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4&quot;</span><span class="p">)</span><span class="c1"># number of rejected GR bins in sample</span>
<span class="n">iref1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># path-integrated SR reflectivity</span>
<span class="n">iref2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># path-integrated GR reflectivity</span>
<span class="n">stdv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># std. dev. of SR reflectivity in sample</span>
<span class="n">stdv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># std. dev. of GR reflectivity in sample</span>
<span class="n">volsr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># total volume of SR bins in sample</span>
<span class="n">volgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>     <span class="c1"># total volume of GR bins in sample</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">time</span>
# Loop over relevant SR profiles
for ii, (ss, rr)  in enumerate(zip(vscan,vray)):
    # Index and count valid bins in each profile
    ip = np.where(valid[ss,rr])[0]
    numbins = len(ip)
    ntotpr[ii]=numbins
    if numbins == 0:
        continue
    # Compute the mean position of these bins
    x[ii]=np.mean(xyzp_sr[ss,rr,ip,0])
    y[ii]=np.mean(xyzp_sr[ss,rr,ip,1])
    z[ii]=np.mean(xyzp_sr[ss,rr,ip,2])

    # Thickness of the layer
    dz[ii]=(numbins * dr_sr) / np.cos( np.radians(alpha[ss, rr]) )

    # SR averaging volume
    volsr[ii]=np.sum(vol_sr[ss, rr, ip])

    # Note mean TRMM beam diameter
    ds[ii]=np.radians(bw_sr) * np.mean( ( (zt-z[ii]) /
                                         np.cos( np.radians(alpha[ss, rr]) ) ) )
    # Note distance from radar
    s=np.sqrt(x[ii]**2+y[ii]**2)
    rs[ii]=(re2+z[ii]) * np.sin(s/re2) / np.cos(np.radians(elev_gr))

    # This should not be required because we applied ZonalData
    ### Check that sample is within radar range
    ##if r[ii,jj]+ds[ii,jj]/2. gt rmax then continue

    ## THIS IS THE ORIGINAL IDL CODE - IS THIS A BUG???
    ##ref1[ii,jj]=MEAN(ref_sr1,/nan)
    ##ref3[ii,jj]=MEAN(ref_sr2,/nan)
    ##ref4[ii,jj]=MEAN(ref_sr3,/nan)

    # Simple linear average of reflectivity
    #   - we can become fancier in the next step
    # ATTENTION: NEED TO FLIP ARRAY

    refsr1[ii]=np.nanmean(ref_sr[ss,rr,ip])
    refsr2[ii]=np.nanmean(ref_sr_ss[ss,rr,ip])
    refsr3[ii]=np.nanmean(ref_sr_sh[ss,rr,ip])

    ## Not sure why we need this...
    ### Note the number of rejected bins
    ##nrej1[ii,jj]=ROUND(TOTAL(FINITE(ref_sr1,/nan)))
    ##if FINITE(stdv1[ii,jj]) eq 0 and np-nrej1[ii,jj] gt 1 then STOP

    # SHOULD WE USE ZONALDATA INSTEAD? COULD BE MORE ACCURATE, BUT ALSO SLOWER
    # WE COULD BASICALLY START A NEW LOOP HERE AND RUN ZONALDATA BEFORE

    # Compute the horizontal distance to all the GR bins
    d = np.sqrt((gr_xyz[...,0]-x[ii])**2 + (gr_xyz[...,1]-y[ii])**2)

    # Find all GR bins within the SR beam
    aa, bb = np.where(d &lt;= ds[ii]/2.)

    # Store the number of bins
    ntotgr[ii] = len(aa)

    if len(aa) == 0:
        continue

    # Extract the relevant GR bins

    # Compute the GR averaging volume
    volgr[ii]=np.sum(vol_gr[aa,bb])

    # Average over those bins that exceed the reflectivity threshold
    #   IDL code does exponential distance and volume weighting
    #   Let&#39;s try simple mean first,
    #   THEN ZonalStats!
    refgr1[ii]=np.nanmean(ref_gr[aa,bb])
    refgr2[ii]=np.nanmean(ref_gr_ku[aa,bb])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 3.58 s, sys: 7.82 ms, total: 3.59 s
Wall time: 3.59 s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr1</span><span class="p">,</span> <span class="n">refsr1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr1</span><span class="p">[</span><span class="n">refsr1</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr1</span><span class="p">[</span><span class="n">refsr1</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;uncorrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[43]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;uncorrected GR vs uncorrected SR&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_79_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_79_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2</span><span class="p">,</span> <span class="n">refsr1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr1</span><span class="p">[</span><span class="n">refsr1</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr1</span><span class="p">[</span><span class="n">refsr1</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[44]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs uncorrected SR&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_80_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_80_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2</span><span class="p">,</span> <span class="n">refsr2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr2</span><span class="p">[</span><span class="n">refsr2</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr2</span><span class="p">[</span><span class="n">refsr2</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs corrected SR snow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[45]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs corrected SR snow&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_81_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_81_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">refgr2</span><span class="p">,</span> <span class="n">refsr3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;SR reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refgr2</span><span class="p">[</span><span class="n">refsr3</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">refsr3</span><span class="p">[</span><span class="n">refsr3</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reflectivity (dBZ)&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;corrected GR vs corrected SR hail&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[46]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Text(0.5,0.98,u&#39;corrected GR vs corrected SR hail&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_82_1.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_82_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">refsr1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SR reflectivity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">150000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">refgr1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;GR reflectivity&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">150000</span><span class="p">,</span> <span class="mi">150000</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;uncorrected GR vs uncorrected SR&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_match3d_wradlib_match_workflow_83_0.png" src="../../_images/notebooks_match3d_wradlib_match_workflow_83_0.png" />
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../develop.html" class="btn btn-neutral float-right" title="For Developers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../zonalstats/wradlib_zonalstats_classes.html" class="btn btn-neutral" title="Zonal Statistics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2016, wradlib developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.11.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>